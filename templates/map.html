{% extends "base.html" %}

{% block title %}
<title>Find Events</title>
<style>
  #map {
  height: 600px;
  width: 90%;
  }
</style>
{% endblock %}

{% block content %}
<h1>Event Finder</h1>

<form method="POST" action="/map">
  <input type="text" name="address" placeholder="Address (ex: 345 Chambers Street)"><br>
  <input type="text" name="radius" placeholder="Mile Radius (ex: 1)"><br>
  <input type="submit" value="Find Events">
</form>

{% set messages = get_flashed_messages() %}
{% for message in messages %}
<h4>{{ message }}</h4>
{% endfor %}
   
<div id="map"></div>
<script>
  function initMap() {
  var nyc = { lat: 40.713, lng: -74.007 };
  var map = new google.maps.Map(document.getElementById('map'), {
  zoom: 14,
  center: nyc
  });

  {% if location is defined %}
  var currentLocation = { lat: {{ location[0] }}, lng: {{ location[1] }} };
  
  var map = new google.maps.Map(document.getElementById('map'), {
  zoom: 14,
  center: currentLocation
  });
  
  var currentLocationMarker = new google.maps.Marker ({
  position: currentLocation,
  map: map
  });
  {% endif %}
  

  {% for event in events %}
  createEventMarker( '{{ event[0] }}', {{ event[3] }}, {{ event[4] }}, '{{ event[5] }}' );
  {% endfor %}
  

  function createEventMarker(name, lat, lon, address) {
  var location = { lat: lat, lng: lon };

  var marker = new google.maps.Marker ({
  position: location,
  map: map,
  icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
  title: 'name'
  });
    
  var infowindow = new google.maps.InfoWindow ({
  content: `${name}<br>${address}`
  });
  
  google.maps.event.addListener(marker, 'click', function() {
  infowindow.open(map, this);
  });
  }
  }
</script>



<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=API_KEY&callback=initMap">
</script>
{% endblock %}
